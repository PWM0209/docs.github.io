# 正则小结

## 示意

1 `\`
斜杠用于转义，在js正则里，只有一些元字符(`*,?,.`等)和`\`本身需要转义，其他的不需要转义
如果其他的字符前面使用了`\`，可能会产生负面影响，比如`\b`，`\t`这些有特殊含义的转义。
此外，在js正则中，\还有一个用处在于使用`new RegExp()`形式创建正则对象时
比如`new RegExp('a\*a')`,其中`*`是乘以的意思，js引擎在解析该正则表达式字符串时，会消耗掉这个斜杠
最后生成的是`a*a`，这时候我们要这样写`'a\\*a'`。

2 `^`
该元字符比较简单，就是表示该正则是从字符串的首字符开始匹配的
有一个地方需要注意的是，如果该正则表达式加了m标记时，匹配到了行分隔符的时候就会结束
然后会在下一行继续匹配。
`'d\nd'.match(/^d/g)    => ['d'], 'd\nd'.match(/^d/mg) =>  ["d", "d"]`

3 `$`
该元字符和^一样，当含义$的正则匹配一个字符串时，他不是直接判断该字符串的结尾
而是以行结束符为分隔，对每一行的结尾进行匹配
`'d\nd'.match(/d$/g)     => ['d'], 'd\nd'.match(/d$/mg)     = > ["d", "d"]`

4 `* + ?`
这三个元字符代表的是匹配0到多个同样的字符组合
`a*`,`a?`,`a+`,分别代表匹配0到多个a，0到1个a,1到多个a
这是一种贪婪的匹配，也就是尽可能多地匹配后面符合条件的字符
如果在这些元字符后面加上?，那么就代表是非贪婪匹配，也就是尽可能少地匹配
`{n,m}`和以上的情况类似，也可以在后面加`?`
`'ddd'.match(/d{1,11}/)    => ddd, 'ddd'.match(/d{1,11}?/) => d`

5 `.`
匹配除了行分隔符外的所有字符

6 捕获分组`(x)` `\n` `$n` `RegExp.$n`
`()`代表捕获分组，`x`代表的表达式所匹配的内容可以在x所有的正则中或者其他地方使用

`/(x)(y)\1\2/.test('xyxy') => true  /(x)(y)\1\2/.test('xyyy') => false`
`\n`代表的是第n个捕获分组的值

`'xy'.replace(/(x)(y)/, "$1 and $2 ") => x and y, RegExp.$1 = x, RegExp.$2 = y`
每次正则执行完后，捕获分组或挂载到RegExp对象上，并且清除上次执行的结果
`$&`是一个特殊的变量，他代表是整个正则表达式匹配到的结果。也就是xy

7 `(?:x)`
非捕获分组，也就是()中的表达式捕获到分组不可在其他地方使用
`'x'.replace(/(?:x)/, "$1") => "$1"`

8 `x(?=y)`
前向断言，断言x后面是y,但y不在捕获分组中
`'x'.match(/x(?=y+)/) => null, 'xyy'.match(/x(?=y+)/) => x`

9 `x(?!y)`
同上，断言x后面不是y。

10 `[\b]`
匹配(U+0008)，键盘中的退格键。

11 `\b`
匹配单词的边界，如果匹配成功，匹配到内容的结果长度为0
单词边界的定义为，某一个位置，后面或者前面没有单词字符，则是单词边界
其中单词字符的定义为`大小写字母`+`数字`+`_`
其余的都为非单词字符
`/a\b/.test('a~b') => true`,`~`被视为单词边界。`/a\b/.test('ab') => false`

12 `\B`
分单词边界，定义类似`\b`。`/a\B/.test('ab') => true, /b\B/.test('ab')  => false`
b的后面是''，属于单词边界，所以是false

13 `\w`
单词字符，定义为`[A-Za-z0-9_]`

14 `\W`
非单词字符，定义为`[^A-Za-z0-9_]`

15 `\s`
所有空格，如制表符、垂直分隔符、水平分隔符，定义为:
`[ \f\n\r\t\v\u00a0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]`

16 `\S`
非空格符，定义为:
`[^ \f\n\r\t\v\u00a0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]`

17 sticky
粘着位类似于全局匹配，当我们使用exec函数时，如果正则表达式中加了g
那么就会下次执行exec函数时就会从上次匹配的结束位置开始
同样，我们可以通过加y标记来达到这个目的
``` js
var x = /a/; x.exec('aa'), x.exec('aa');
// lastIndex为上次匹配的位置，lastIndex为不会变，每次都匹配到第一个a
var x = /a/g; x.exec('aa'), x.exec('aa'); 
// lastIndex会变，第n次匹配会匹配到第n个a
var x = /a/y; x.exec('aa'), x.exec('aa'); 
// lastIndex会变，第n次匹配会匹配到第n个a,粘着位其实就是说上次匹配的位置会粘着（记着）
```

18 使用`new RegExp()`
动态生成正则时需要使用这种方式，但是需要对输入进行转义。需要对元字符进行修正，$&为每次匹配到的字符
```js
function fix(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}
```

## 例子

### 匹配数字
1 数字：
`^[0-9]*$`

2 n位的数字：
`^\d{n}$`

3 至少n位的数字：
`^\d{n,}$`

4 m-n位的数字：
`^\d{m,n}$`

5 零和非零开头的数字：
`^(0|[1-9][0-9]*)$`

6 非零开头的最多带两位小数的数字：
`^([1-9][0-9]*)+(.[0-9]{1,2})?$`

7 带1-2位小数的正数或负数：
`^(\-)?\d+(\.\d{1,2})?$`

8 正数、负数、和小数：
`^(\-|\+)?\d+(\.\d+)?$`

9 有两位小数的正实数：
`^[0-9]+(.[0-9]{2})?$`

10 有1~3位小数的正实数：
`^[0-9]+(.[0-9]{1,3})?$`

11 非零的正整数：
`^[1-9]\d*$ 或 ^([1-9][0-9]*){1,3}$ 或 ^\+?[1-9][0-9]*$`

12 非零的负整数：
`^\-[1-9][]0-9"*$ 或 ^-[1-9]\d*$`

13 非负整数：
`^\d+$ 或 ^[1-9]\d*|0$`

14 非正整数：
`^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$`

15 非负浮点数：
`^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$`

16 非正浮点数：
`^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$`

17 正浮点数：
`^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$`

18 负浮点数：
`^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$`

19 浮点数：
`^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$`

### 校验字符

1 汉字：
`^[\u4e00-\u9fa5]{0,}$`

2 英文和数字：
`^[A-Za-z0-9]+$` 或 `^[A-Za-z0-9]{4,40}$`

3 长度为3-20的所有字符：
`^.{3,20}$`

4 由26个英文字母组成的字符串：
`^[A-Za-z]+$`

5 由26个大写英文字母组成的字符串：
`^[A-Z]+$`

6 由26个小写英文字母组成的字符串：
`^[a-z]+$`

7 由数字和26个英文字母组成的字符串：
`^[A-Za-z0-9]+$`

8 由数字、26个英文字母或者下划线组成的字符串：
`^\w+$ 或 ^\w{3,20}$`

9 中文、英文、数字包括下划线：
`^[\u4E00-\u9FA5A-Za-z0-9_]+$`

10 中文、英文、数字但不包括下划线等符号：
`^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]{2,20}$`

11 可以输入含有^%&',;=?$\"等字符：
`[^%&',;=?$\x22]+`

12 禁止输入含有~的字符：
`[^~\x22]+`

### 特殊需求
1 Email地址：
`^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$`

2 域名：
`[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?`

3 InternetURL：
`[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&=]*)?$`

4 手机号码最新： 
`^((13[0-9])|(14[5,7])|(15[0-3,5-9])|(17[0,3,5-8])|(18[0-9])|166|198|199|(147))\d{8}$`

5 电话号码("XXX-XXXXXXX"、"XXXX-XXXXXXXX"、"XXX-XXXXXXX"、"XXX-XXXXXXXX"、"XXXXXXX"和"XXXXXXXX)：
`^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$`

6 国内电话号码(0511-4405222、021-87888822)：
`\d{3}-\d{8}|\d{4}-\d{7}`

7 身份证号(15位、18位数字)：
`^\d{15}|\d{18}$`

8 短身份证号码(数字、字母x结尾)：
`^([0-9]){7,18}(x|X)?$ 或 ^\d{8,18}|[0-9x]{8,18}|[0-9X]{8,18}?$`

9 帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：
`^[a-zA-Z][a-zA-Z0-9_]{4,15}$`

10 密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：
`^[a-zA-Z]\w{5,17}$`

11 强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：
`^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$`

12 日期格式：
`^\d{4}-\d{1,2}-\d{1,2}`

13 一年的12个月(01～09和1～12)：
`^(0?[1-9]|1[0-2])$`

14 一个月的31天(01～09和1～31)：
`^((0?[1-9])|((1|2)[0-9])|30|31)$`

